<div is="emby-scroller" class="view flex flex-direction-column scrollFrameY flex-grow" data-horizontal="false" data-forcescrollbar="true" data-centerfocus="true" data-bindheader="true" data-controller="__plugin/MetaExtractorConfigurationjs" data-title="Metadata Exporter">
    <style>
        .export-section,
        .settings-section {
            padding: 1.5em;
            background: rgba(0, 0, 0, .2);
            border-radius: 8px;
            margin-bottom: 2em;
        }

            .export-section h2,
            .settings-section h2 {
                margin-top: 0;
                color: #00a4dc;
            }

        .export-button {
            background: #00a4dc;
            color: white;
            padding: 1em 2em;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background 0.3s;
        }

            .export-button:hover {
                background: #0088b8;
            }

            .export-button:disabled {
                background: #555;
                cursor: not-allowed;
            }

        .library-list {
            margin: 1em 0;
            display: flex;
            flex-direction: column;
            gap: 0.5em;
        }

        .library-item {
            padding: 0.5em;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .checkboxContainer {
            margin: 0.5em 0;
        }

        .item-browser {
            margin-top: 1em;
            padding: 1em;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 0.3em;
        }

        .item-entry {
            padding: 0.5em;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 3px;
            font-size: 0.9em;
        }

        .browse-button {
            margin-top: 0.5em;
            font-size: 0.9em;
        }

        .item-browser-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5em;
            padding-bottom: 0.5em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .selection-mode {
            margin: 1em 0;
            padding: 1em;
            background: rgba(0, 120, 215, 0.1);
            border-radius: 4px;
            border-left: 3px solid #00a4dc;
        }

        .selection-mode label {
            display: block;
            margin: 0.5em 0;
        }

        .selected-count {
            color: #00a4dc;
            font-weight: bold;
        }

        .settings-group {
            margin: 1.5em 0;
        }

            .settings-group h3 {
                color: #00a4dc;
                margin-bottom: 0.8em;
                font-size: 1.1em;
            }

        .checkbox-list {
            display: flex;
            flex-direction: column;
        }

        #resultsContainer {
            margin-top: 2em;
            margin-bottom: 2em;
            display: none;
        }

            #resultsContainer.visible {
                display: block;
            }

        .results-header {
            padding: 1.5em;
            border-radius: 5px;
            margin-bottom: 1em;
        }

            .results-header.success {
                background-color: #224922;
                border-left: 5px solid #3ad83a;
            }

            .results-header.error {
                background-color: #492222;
                border-left: 5px solid #d83a3a;
            }

            .results-header h3 {
                margin: 0 0 0.5em 0;
            }

        .results-meta {
            color: #999;
            font-size: 0.9em;
        }

        .info-text {
            color: #aaa;
            font-size: 0.9em;
            margin-top: 0.5em;
        }
        
        .dry-run-log {
            margin-top: 1em;
            padding: 1em;
            background: #ffffff;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            border: 1px solid #ddd;
        }
        
        .dry-run-log-entry {
            padding: 0.3em 0;
            border-bottom: 1px solid #e0e0e0;
            color: #000000;
        }
        
        .dry-run-log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5em;
            padding-bottom: 0.5em;
            border-bottom: 2px solid rgba(0, 164, 220, 0.3);
        }
        
        .dry-run-log-count {
            color: #00a4dc;
            font-weight: bold;
        }

        .loading-spinner {
            display: none;
            margin-top: 1em;
            flex-direction: column;
            gap: 0.5em;
        }

            .loading-spinner.active {
                display: flex;
            }

            .loading-spinner .spinner-content {
                display: flex;
                align-items: center;
                gap: 0.5em;
            }

            .loading-spinner .progress-text {
                color: #00a4dc;
                font-size: 0.9em;
            }

            .loading-spinner .progress-bar-container {
                width: 100%;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                height: 20px;
                overflow: hidden;
            }

            .loading-spinner .progress-bar {
                height: 100%;
                background: linear-gradient(90deg, #00a4dc, #00c8ff);
                width: 0%;
                transition: width 0.3s ease;
                border-radius: 10px;
            }
        
        .tab-navigation {
            display: flex;
            gap: 0.5em;
            margin-bottom: 1.5em;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .tab-button {
            padding: 0.8em 1.5em;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: #aaa;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .tab-button:hover {
            color: #fff;
        }
        
        .tab-button.active {
            color: #00a4dc;
            border-bottom-color: #00a4dc;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .export-log-actions {
            display: flex;
            gap: 0.5em;
            margin-bottom: 1em;
        }
        
        .extract-log-button {
            background: #4CAF50;
            color: white;
            padding: 0.5em 1em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .extract-log-button:hover {
            background: #45a049;
        }
    </style>

    <div class="scrollSlider flex-grow flex-direction-column padded-left padded-right padded-top-page padded-bottom-page">
        <div class="tab-navigation">
            <button type="button" class="tab-button active" data-tab="export-tab">
                <i class="md-icon">cloud_upload</i>
                <span>Export</span>
            </button>
            <button type="button" class="tab-button" data-tab="settings-tab">
                <i class="md-icon">settings</i>
                <span>Settings</span>
            </button>
            <button type="button" class="tab-button" data-tab="introskip-tab">
                <i class="md-icon">skip_next</i>
                <span>Intro Skip Backup</span>
            </button>
            <button type="button" class="tab-button" data-tab="scheduledtask-tab">
                <i class="md-icon">schedule</i>
                <span>Scheduled Task</span>
            </button>
            <button type="button" class="tab-button" data-tab="log-tab">
                <i class="md-icon">article</i>
                <span>Export Log</span>
            </button>
        </div>
        
        <form class="MetadataExporterConfigurationForm">
            <div id="export-tab" class="tab-content active">
            <div class="export-section">
                <h2>üì¶ Export Metadata & Artwork</h2>
                <p>Export metadata and artwork from Emby's database to your media folders as NFO files and images.</p>

                <div class="settings-group">
                    <h3>Select Libraries</h3>
                    <div class="selection-mode">
                        <label>
                            <input type="radio" name="selectionMode" value="library" checked />
                            <span>Export entire libraries</span>
                        </label>
                        <label>
                            <input type="radio" name="selectionMode" value="individual" />
                            <span>Select individual items</span>
                        </label>
                    </div>
                    
                    <div id="librarySelectionContainer">
                        <p class="info-text">Choose which libraries should have their metadata exported:</p>
                        <div id="libraryList" class="library-list">
                        </div>
                    </div>

                    <div id="itemSelectionContainer" style="display: none;">
                        <p class="info-text">Browse and select individual movies or TV shows:</p>
                        <div>
                            <label for="libraryPicker">Library:</label>
                            <select id="libraryPicker" is="emby-select" style="margin: 0.5em 0;">
                                <option value="">-- Select a library --</option>
                            </select>
                            <button is="emby-button" type="button" class="raised browse-button" id="browseItemsBtn">
                                <span>Browse Items</span>
                            </button>
                        </div>
                        <div id="itemBrowser" class="item-browser" style="display: none;">
                            <div class="item-browser-header">
                                <span>Select items to export:</span>
                                <span class="selected-count"><span id="selectedItemCount">0</span> items selected</span>
                            </div>
                            <div id="itemList" class="item-list">
                            </div>
                        </div>
                    </div>
                </div>

                <button is="emby-button" type="button" class="raised button-submit block export-button" id="exportBtn">
                    <i class="md-icon">save</i>
                    <span>Export Metadata</span>
                </button>

                <div id="loadingSpinner" class="loading-spinner">
                    <div class="spinner-content">
                        <i class="md-icon">hourglass_empty</i>
                        <span>Exporting metadata...</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text" id="progressText">Starting export...</div>
                </div>

                <div id="resultsContainer">
                    <div id="resultsHeader" class="results-header">
                        <h3 id="resultsTitle"></h3>
                        <div id="resultsStats" class="results-meta"></div>
                    </div>
                    <div id="errorList"></div>
                </div>
            </div>
            </div>
            
            <div id="settings-tab" class="tab-content">
            <div class="settings-section">
                <h2>‚öôÔ∏è Export Settings</h2>

                <div class="settings-group">
                    <h3>Export Types</h3>
                    <div class="checkbox-list">
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="exportArtwork" name="exportArtwork" />
                                <span>Export Artwork</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="exportNfo" name="exportNfo" />
                                <span>Export NFO Files</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Item Types to Export</h3>
                    <div class="checkbox-list">
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="exportCollections" name="exportCollections" />
                                <span>Export Collections (BoxSets)</span>
                            </label>
                            <div class="fieldDescription">When enabled, collection metadata and artwork will be exported. Collections/BoxSets contain movies grouped together (e.g., Marvel Cinematic Universe, Star Wars, etc.)</div>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>File Options</h3>
                    <div class="checkbox-list">
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="overwriteNfo" name="overwriteNfo" />
                                <span>Overwrite existing NFO files</span>
                            </label>
                            <div class="fieldDescription">When enabled, existing NFO metadata files will be replaced. When disabled, only missing NFO files will be created.</div>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="overwriteArtwork" name="overwriteArtwork" />
                                <span>Overwrite existing artwork files</span>
                            </label>
                            <div class="fieldDescription">When enabled, existing image files will be replaced. When disabled, only missing image files will be created.</div>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="dryRun" name="dryRun" />
                                <span>Dry Run Mode (Preview only)</span>
                            </label>
                            <div class="fieldDescription">When enabled, no files will be written. The plugin will only log what would be exported.</div>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="useCustomExportPath" name="useCustomExportPath" />
                                <span>Export to custom folder</span>
                            </label>
                            <div class="fieldDescription">When enabled, files will be exported to a custom folder instead of the media library locations. The folder structure will mimic the original library structure.</div>
                        </div>
                        <div class="inputContainer" id="customExportPathContainer" style="display: none; margin-top: 0.5em;">
                            <label class="inputLabel inputLabelUnfocused" for="customExportPath">Custom Export Folder Path:</label>
                            <div style="display: flex; gap: 0.5em;">
                                <input is="emby-input" type="text" id="customExportPath" name="customExportPath" style="flex: 1;" />
                                <button is="emby-button" type="button" id="browseExportPath" class="raised">
                                    <span>Browse...</span>
                                </button>
                            </div>
                            <div class="fieldDescription">Enter the full path where files should be exported (e.g., C:\ExportedMetadata or /media/exported)</div>
                        </div>
                        <div class="checkboxContainer" id="useHardlinksContainer" style="display: none; margin-top: 0.5em; margin-left: 2em;">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="useHardlinks" name="useHardlinks" />
                                <span>Use hardlinks for artwork (saves disk space)</span>
                            </label>
                            <div class="fieldDescription">When enabled, hardlinks will be created instead of copying artwork files. This saves disk space but only works when both source and destination are on the same filesystem.</div>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Artwork Types</h3>
                    <p class="info-text">Select which artwork types to export:</p>
                    
                    <div class="checkboxContainer checkboxContainer-withDescription" style="margin-bottom: 1em; padding: 1em; background: rgba(0, 180, 255, 0.1); border-radius: 4px; border-left: 3px solid #00a4dc;">
                        <label class="emby-checkbox-label">
                            <input is="emby-checkbox" type="checkbox" id="exportAllArtworkTypes" name="exportAllArtworkTypes" />
                            <span style="font-weight: bold;">Export All Artwork Types (Recommended)</span>
                        </label>
                        <div class="fieldDescription">When enabled, the plugin will automatically detect and export ALL image types that Emby has for each item (Primary, Backdrop, Logo, Banner, Thumb, Art, Disc, Box, Screenshot, Menu, Chapter, Profile, etc.). This overrides the individual checkboxes below and ensures no artwork is missed.</div>
                    </div>
                    
                    <div id="individualArtworkTypes">
                        <p class="info-text" style="font-size: 0.9em; opacity: 0.7;">Or select specific types:</p>
                        <div class="checkbox-list">
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="exportPoster" name="exportPoster" />
                                    <span>Poster</span>
                                </label>
                            </div>
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="exportBackdrop" name="exportBackdrop" />
                                    <span>Backdrop</span>
                                </label>
                            </div>
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="exportLogo" name="exportLogo" />
                                    <span>Logo</span>
                                </label>
                            </div>
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="exportBanner" name="exportBanner" />
                                    <span>Banner</span>
                                </label>
                            </div>
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="exportThumb" name="exportThumb" />
                                    <span>Thumb</span>
                                </label>
                            </div>
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="exportArt" name="exportArt" />
                                    <span>Clear Art</span>
                                </label>
                            </div>
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="exportDisc" name="exportDisc" />
                                    <span>Disc</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Custom Artwork Names</h3>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input is="emby-checkbox" type="checkbox" id="chkUseCustomArtworkNames" />
                            <span>Use Custom Artwork Names</span>
                        </label>
                        <div class="fieldDescription">Enable to specify custom file names for exported artwork (default: Emby standard names)</div>
                    </div>
                    
                    <div id="customArtworkNamesContainer" style="display: none; margin-top: 1em; padding: 1em; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1em;">
                            <div>
                                <label class="inputLabel" for="txtCustomPosterName">Poster Name:</label>
                                <input is="emby-input" type="text" id="txtCustomPosterName" placeholder="poster" />
                            </div>
                            <div>
                                <label class="inputLabel" for="txtCustomFanartName">Fanart Name (base):</label>
                                <input is="emby-input" type="text" id="txtCustomFanartName" placeholder="fanart" />
                                <div class="fieldDescription">Additional backdrops will be named: fanart1, fanart2, etc.</div>
                            </div>
                            <div>
                                <label class="inputLabel" for="txtCustomLogoName">Logo Name:</label>
                                <input is="emby-input" type="text" id="txtCustomLogoName" placeholder="clearlogo" />
                            </div>
                            <div>
                                <label class="inputLabel" for="txtCustomBannerName">Banner Name:</label>
                                <input is="emby-input" type="text" id="txtCustomBannerName" placeholder="banner" />
                            </div>
                            <div>
                                <label class="inputLabel" for="txtCustomThumbName">Thumb Name:</label>
                                <input is="emby-input" type="text" id="txtCustomThumbName" placeholder="landscape" />
                            </div>
                            <div>
                                <label class="inputLabel" for="txtCustomArtName">Clear Art Name:</label>
                                <input is="emby-input" type="text" id="txtCustomArtName" placeholder="clearart" />
                            </div>
                            <div>
                                <label class="inputLabel" for="txtCustomDiscName">Disc Name:</label>
                                <input is="emby-input" type="text" id="txtCustomDiscName" placeholder="disc" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>NFO Metadata Fields</h3>
                    <p class="info-text">Select which metadata fields to include in NFO files:</p>
                    <div style="margin-bottom: 1em;">
                        <button is="emby-button" type="button" id="selectAllNfo" class="raised button-submit">
                            <span>Select All</span>
                        </button>
                        <button is="emby-button" type="button" id="selectNoneNfo" class="raised">
                            <span>Select None</span>
                        </button>
                    </div>
                    <div class="checkbox-list">
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeActors" name="nfoIncludeActors" />
                                <span>Actors/Cast</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeCertification" name="nfoIncludeCertification" />
                                <span>Certification (Additional to MPAA)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeCollections" name="nfoIncludeCollections" />
                                <span>Collections/Sets (Movie collections with provider IDs)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeCountries" name="nfoIncludeCountries" />
                                <span>Countries</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeDates" name="nfoIncludeDates" />
                                <span>Dates (Premiered, Release Date, Date Added)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeDetailedRatings" name="nfoIncludeDetailedRatings" />
                                <span>Detailed Ratings Structure (Multiple rating sources)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeDirectors" name="nfoIncludeDirectors" />
                                <span>Directors</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeFanart" name="nfoIncludeFanart" />
                                <span>Fanart Section (Image URLs with aspect attributes)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeGenres" name="nfoIncludeGenres" />
                                <span>Genres</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeMpaa" name="nfoIncludeMpaa" />
                                <span>MPAA Rating</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludePlot" name="nfoIncludePlot" />
                                <span>Plot/Overview</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeProviderIds" name="nfoIncludeProviderIds" />
                                <span>Provider IDs (IMDB, TVDB, TMDB, etc.)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeRating" name="nfoIncludeRating" />
                                <span>Ratings (Community & Critic)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeRuntime" name="nfoIncludeRuntime" />
                                <span>Runtime</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeStudios" name="nfoIncludeStudios" />
                                <span>Studios</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeTagline" name="nfoIncludeTagline" />
                                <span>Tagline</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeTags" name="nfoIncludeTags" />
                                <span>Tags</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeTitles" name="nfoIncludeTitles" />
                                <span>Titles (Title, Original Title, Sort Title)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeTrailers" name="nfoIncludeTrailers" />
                                <span>Trailers</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeUniqueIds" name="nfoIncludeUniqueIds" />
                                <span>Unique IDs (uniqueid elements and individual ID fields)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeWriters" name="nfoIncludeWriters" />
                                <span>Writers/Credits</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeChapters" name="nfoIncludeChapters" />
                                <span>Chapters (Chapter markers with timestamps)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="nfoIncludeYear" name="nfoIncludeYear" />
                                <span>Year</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            
            <div id="introskip-tab" class="tab-content">
                <div class="settings-section">
                    <h2>‚è≠Ô∏è Intro Skip Backup & Restore</h2>
                    <p>Backup and restore intro skip markers (IntroStart, IntroEnd, CreditStart) to/from JSON files. This protects your intro detection data from being lost during library rebuilds or database issues.</p>
                    <p class="info-text">üí° <strong>Tip:</strong> Configure automatic backups in the <strong>Scheduled Task</strong> tab.</p>
                    
                    <div id="introSkipSettings" style="margin-top: 1.5em;">
                        
                        <h3 style="margin-top: 1em; color: #00a4dc;">Matching Options</h3>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="chkIntroSkipUseTvdbMatching" checked />
                                <span>Use theTVDB Episode ID Matching (Recommended)</span>
                            </label>
                            <div class="fieldDescription">When enabled, uses theTVDB episode IDs for matching during restore, making intro skip data more portable across different Emby installations or library rebuilds. This is enabled by default for maximum portability.</div>
                        </div>
                        
                        <h3 style="margin-top: 1em; color: #00a4dc;">Backup Mode</h3>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="chkIntroSkipSavePerEpisode" />
                                <span>Save Per-Episode (Like NFO Files)</span>
                            </label>
                            <div class="fieldDescription">When enabled, saves intro skip data as individual JSON files. You can save them alongside each episode (next to video files) or in a custom organized folder structure. When disabled, uses a single centralized backup file.</div>
                        </div>
                        
                        <div id="perEpisodeOptionsSection" style="margin-left: 2em; margin-top: 1em; display: none;">
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input is="emby-checkbox" type="checkbox" id="chkIntroSkipUseCustomFolder" />
                                    <span>Use Custom Folder (Instead of Next to Videos)</span>
                                </label>
                                <div class="fieldDescription">Save intro skip files to a custom organized folder structure instead of next to video files. Files will be organized as: SeriesName/Season XX/episode.intro.json</div>
                            </div>
                            
                            <div id="customFolderSection" style="margin-top: 1em; display: none;">
                                <div class="inputContainer">
                                    <label class="inputLabel" for="txtIntroSkipCustomFolderPath">Custom Folder Path</label>
                                    <div style="display: flex; gap: 0.5em; align-items: center;">
                                        <input is="emby-input" type="text" id="txtIntroSkipCustomFolderPath" placeholder="D:\Backups\IntroSkips" style="flex: 1;" />
                                        <button is="emby-button" type="button" class="raised button-submit" id="browseCustomFolderPath" style="white-space: nowrap; padding: 0.6em 1em;">
                                            <span>Browse</span>
                                        </button>
                                    </div>
                                    <div class="fieldDescription">Path to the custom folder where intro skip files will be saved in an organized structure (e.g., D:\Backups\IntroSkips). Each series will get its own subfolder with season folders inside.</div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="centralizedBackupSection" style="margin-top: 1.5em;">
                        <div class="inputContainer">
                            <label class="inputLabel" for="txtIntroSkipBackupFilePath">Backup File Path</label>
                            <div style="display: flex; gap: 0.5em; align-items: center;">
                                <input is="emby-input" type="text" id="txtIntroSkipBackupFilePath" placeholder="D:\Backups\intro_markers.json" style="flex: 1;" />
                                <button is="emby-button" type="button" class="raised button-submit" id="browseBackupFilePath" style="white-space: nowrap; padding: 0.6em 1em;">
                                    <span>Browse</span>
                                </button>
                            </div>
                            <div class="fieldDescription">Full path to the backup JSON file including filename (e.g., D:\Backups\intro_markers.json or C:\ProgramData\Emby-Server\intro_markers.json). The file will be created if it doesn't exist, and updated with new/modified episodes when you backup.</div>
                        </div>
                        </div>

                        <h3 style="margin-top: 2em; color: #00a4dc;">Selection Mode</h3>
                        
                        <div class="checkboxContainer">
                            <label class="emby-radio-label">
                                <input is="emby-radio" type="radio" name="introSkipSelectionMode" value="library" id="radioIntroSkipLibrary" />
                                <span>Backup by Library</span>
                            </label>
                        </div>
                        <div class="checkboxContainer">
                            <label class="emby-radio-label">
                                <input is="emby-radio" type="radio" name="introSkipSelectionMode" value="individual" id="radioIntroSkipIndividual" />
                                <span>Backup Individual Series/Shows</span>
                            </label>
                        </div>

                        <div id="introSkipLibrarySelection" style="margin-top: 1em;">
                            <h4>Select Libraries</h4>
                            <div id="introSkipLibraryList" class="library-list">
                                <p style="color: #666;">Loading libraries...</p>
                            </div>
                        </div>

                        <div id="introSkipSeriesSelection" style="margin-top: 1em; display: none;">
                            <h4>Select Series/Shows</h4>
                            <div class="inputContainer">
                                <input is="emby-input" type="text" id="seriesSearchBox" placeholder="Search series by name..." style="margin-bottom: 1em;" />
                            </div>
                            <div id="introSkipSeriesList" class="library-list" style="max-height: 400px; overflow-y: auto;">
                                <p style="color: #666;">Loading series...</p>
                            </div>
                        </div>

                        <h3 style="margin-top: 2em; color: #00a4dc;">Restore Options</h3>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription" style="margin-top: 1em;">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="chkIntroSkipRestoreFromScan" />
                                <span>Restore by Scanning Folders</span>
                            </label>
                            <div class="fieldDescription">When enabled, restore will scan specified folder paths for .intro.json files instead of using the centralized backup file. Useful when intro data is saved per-episode.</div>
                        </div>
                        
                        <div id="scanFoldersSection" style="margin-top: 1em; display: none;">
                            <label class="inputLabel">Folders to Scan</label>
                            <div id="scanFoldersList" style="margin-bottom: 0.5em;">
                                <!-- Scan folders will be added here -->
                            </div>
                            <div style="display: flex; gap: 0.5em;">
                                <input is="emby-input" type="text" id="txtNewScanFolder" placeholder="D:\Media\TV Shows" style="flex: 1;" />
                                <button is="emby-button" type="button" class="raised button-submit" id="addScanFolderBtn" style="white-space: nowrap; padding: 0.6em 1em;">
                                    <span>Add Folder</span>
                                </button>
                            </div>
                            <div class="fieldDescription">Add root folders to scan recursively for .intro.json files. All subfolders will be scanned.</div>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription" style="margin-top: 1em;">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="chkIntroSkipIncludeInNfo" />
                                <span>Include Markers in NFO Export</span>
                            </label>
                            <div class="fieldDescription">Also export intro skip markers to NFO chapter sections (for documentation/backup)</div>
                        </div>

                        <h3 style="margin-top: 2em; color: #00a4dc;">Backup Actions</h3>
                        
                        <div style="margin-bottom: 1em; padding: 1em; background: rgba(0,164,220,0.1); border-radius: 4px;">
                            <p style="margin: 0; color: #00a4dc;">
                                <strong>How it works:</strong> In centralized mode, selected shows/libraries are added/updated in your backup file. In per-episode mode, each episode gets its own .intro.json file saved alongside it (like NFO files). Click "Restore" to restore intro markers from either the backup file or by scanning folders.
                            </p>
                        </div>
                        
                        <div style="display: flex; gap: 1em; margin-top: 1em;">
                            <button type="button" class="export-button" id="backupIntroSkipBtn">
                                <i class="md-icon">backup</i>
                                <span>Save & Backup Selected Shows</span>
                            </button>
                            <button type="button" class="export-button" id="restoreIntroSkipBtn">
                                <i class="md-icon">restore</i>
                                <span>Restore from Backup File</span>
                            </button>
                        </div>
                        
                        <h3 style="margin-top: 2em; color: #00a4dc;">üîÑ Server Migration Tools</h3>
                        
                        <div style="margin-bottom: 1em; padding: 1em; background: rgba(139,195,74,0.1); border-radius: 4px; border-left: 4px solid #8bc34a;">
                            <p style="margin: 0; color: #8bc34a;">
                                <strong>Migration Export/Import:</strong> Use these tools when moving to a new Emby server or reinstalling. Export creates a simplified, portable file with ALL intro markers (no episode selection needed). The export file uses only theTVDB IDs for maximum compatibility across different servers.
                            </p>
                        </div>
                        
                        <div style="display: flex; gap: 1em; margin-top: 1em;">
                            <button type="button" class="export-button" id="exportMigrationBtn" style="background: linear-gradient(135deg, #8bc34a 0%, #689f38 100%);">
                                <i class="md-icon">upload</i>
                                <span>Export All for Migration</span>
                            </button>
                            <button type="button" class="export-button" id="importMigrationBtn" style="background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);">
                                <i class="md-icon">download</i>
                                <span>Import Migration File</span>
                            </button>
                        </div>

                        <!-- Progress Display -->
                        <div id="introSkipProgressContainer" style="margin-top: 1.5em; padding: 1.5em; background: rgba(0,0,0,0.3); border-radius: 8px; display: none;">
                            <h4 style="margin-top: 0; color: #00a4dc; display: flex; align-items: center;">
                                <i class="md-icon" style="margin-right: 0.5em;">sync</i>
                                <span id="progressOperation">Processing</span> Intro Skip Data
                            </h4>
                            
                            <div style="margin: 1em 0;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5em;">
                                    <span id="progressStatus">Initializing...</span>
                                    <span id="progressPercentage">0%</span>
                                </div>
                                <div style="background: rgba(255,255,255,0.1); height: 24px; border-radius: 4px; overflow: hidden; position: relative;">
                                    <div id="progressBar" style="background: linear-gradient(90deg, #00a4dc, #0078d7); height: 100%; width: 0%; transition: width 0.3s; display: flex; align-items: center; justify-content: center;">
                                        <span id="progressBarText" style="font-size: 12px; color: white; font-weight: bold;"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1em; margin: 1em 0;">
                                <div style="background: rgba(0,164,220,0.2); padding: 0.75em; border-radius: 4px;">
                                    <div style="font-size: 0.85em; opacity: 0.8;">Processed</div>
                                    <div style="font-size: 1.5em; font-weight: bold;" id="progressProcessed">0</div>
                                </div>
                                <div style="background: rgba(0,200,83,0.2); padding: 0.75em; border-radius: 4px;">
                                    <div style="font-size: 0.85em; opacity: 0.8;">Success</div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: #00c853;" id="progressSuccess">0</div>
                                </div>
                                <div style="background: rgba(255,235,59,0.2); padding: 0.75em; border-radius: 4px;">
                                    <div style="font-size: 0.85em; opacity: 0.8;">Skipped</div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: #ffeb3b;" id="progressSkipped">0</div>
                                </div>
                                <div style="background: rgba(244,67,54,0.2); padding: 0.75em; border-radius: 4px;">
                                    <div style="font-size: 0.85em; opacity: 0.8;">Failed</div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: #f44336;" id="progressFailed">0</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 1em;">
                                <div style="font-size: 0.9em; opacity: 0.8;">Current: <span id="progressCurrentSeries">-</span></div>
                                <div style="font-size: 0.85em; opacity: 0.7; margin-top: 0.25em;" id="progressCurrentItem">-</div>
                                <div style="font-size: 0.85em; opacity: 0.7; margin-top: 0.5em;">Time Remaining: <span id="progressEta">Calculating...</span></div>
                            </div>
                            
                            <div id="progressLogContainer" style="margin-top: 1em;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5em;">
                                    <h5 style="margin: 0;">Activity Log</h5>
                                    <button type="button" id="clearProgressLog" style="background: rgba(255,255,255,0.1); border: none; padding: 0.3em 0.8em; border-radius: 3px; cursor: pointer; font-size: 0.8em;">Clear</button>
                                </div>
                                <div id="progressLog" style="background: rgba(0,0,0,0.5); padding: 0.75em; border-radius: 4px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 0.85em;">
                                </div>
                            </div>
                            
                            <div id="validationErrorsContainer" style="margin-top: 1em; display: none;">
                                <h5 style="margin: 0.5em 0; color: #ff9800;">‚ö†Ô∏è Validation Warnings</h5>
                                <div id="validationErrors" style="background: rgba(255,152,0,0.2); padding: 0.75em; border-radius: 4px; max-height: 150px; overflow-y: auto; font-size: 0.85em; border-left: 4px solid #ff9800;">
                                </div>
                            </div>
                        </div>

                        <div id="introSkipStatus" style="margin-top: 1em; padding: 1em; background: rgba(0,0,0,0.3); border-radius: 4px; display: none;">
                            <p id="introSkipStatusText" style="margin: 0;"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="scheduledtask-tab" class="tab-content">
                <div class="settings-section">
                    <h2>üïê Scheduled Task Configuration</h2>
                    <p>Configure what the "Metadata Backup" scheduled task will backup automatically. The scheduled task can be configured and run from <strong>Dashboard ‚Üí Scheduled Tasks</strong>.</p>
                    
                    <div style="margin: 2em 0; padding: 1.5em; background: rgba(0,120,215,0.1); border-radius: 8px; border-left: 4px solid #00a4dc;">
                        <h3 style="margin-top: 0; color: #00a4dc;">What to Backup</h3>
                        <p class="info-text">Select which types of data the scheduled task should backup. These settings are independent of manual backup operations.</p>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription" style="margin-top: 1.5em;">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="chkScheduledTaskBackupNfo" />
                                <span>Backup NFO Files</span>
                            </label>
                            <div class="fieldDescription">When enabled, the scheduled task will export metadata to NFO files using the settings configured in the <strong>Export</strong> and <strong>Settings</strong> tabs (libraries, selection mode, NFO format, etc.)</div>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription" style="margin-top: 1em;">
                            <label class="emby-checkbox-label">
                                <input is="emby-checkbox" type="checkbox" id="chkScheduledTaskBackupIntroSkips" />
                                <span>Backup Intro Skip Markers</span>
                            </label>
                            <div class="fieldDescription">When enabled, the scheduled task will backup intro skip markers using the settings configured in the <strong>Intro Skip Backup</strong> tab (backup mode, TMDB matching, custom folder, etc.)</div>
                        </div>
                    </div>
                    
                    <div style="margin: 2em 0; padding: 1.5em; background: rgba(76, 175, 80, 0.1); border-radius: 8px; border-left: 4px solid #4caf50;">
                        <h3 style="margin-top: 0; color: #4caf50;">üìã How to Use</h3>
                        <ol style="margin: 0.5em 0; padding-left: 1.5em; line-height: 1.8;">
                            <li>Enable the backup types you want (NFO files and/or intro skips)</li>
                            <li>Configure the detailed settings for each backup type in their respective tabs</li>
                            <li>Go to <strong>Dashboard ‚Üí Scheduled Tasks</strong> in Emby</li>
                            <li>Find <strong>"Metadata Backup"</strong> in the Library category</li>
                            <li>Configure the schedule (default: daily at 2 AM) or run manually</li>
                        </ol>
                    </div>
                    
                    <div style="margin: 2em 0; padding: 1.5em; background: rgba(255, 152, 0, 0.1); border-radius: 8px; border-left: 4px solid #ff9800;">
                        <h3 style="margin-top: 0; color: #ff9800;">‚ö†Ô∏è Important Notes</h3>
                        <ul style="margin: 0.5em 0; padding-left: 1.5em; line-height: 1.8;">
                            <li>If both options are disabled, the scheduled task will exit without doing anything</li>
                            <li>NFO backups use the library/item selection from the Export tab</li>
                            <li>Intro skip backups use the library/series selection from the Intro Skip Backup tab</li>
                            <li>The scheduled task respects all other settings (dry run, overwrite, custom paths, etc.)</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div id="log-tab" class="tab-content">
                <div class="settings-section">
                    <h2>üìã Export Log</h2>
                    <p>View detailed logs of export operations. Logs are only stored in memory and not saved to disk unless you export them.</p>
                    
                    <div class="export-log-actions">
                        <button type="button" class="extract-log-button" id="exportLogBtn">
                            <i class="md-icon">download</i>
                            <span>Download Log</span>
                        </button>
                        <button type="button" class="extract-log-button" id="clearLogBtn" style="background: #f44336;">
                            <i class="md-icon">delete</i>
                            <span>Clear Log</span>
                        </button>
                    </div>
                    
                    <div id="exportLogContainer">
                        <div class="dry-run-log-header">
                            <h4 style="margin: 0;">Export Operations</h4>
                            <span class="dry-run-log-count"><span id="exportLogCount">0</span> operations logged</span>
                        </div>
                        <div id="exportLogList" class="dry-run-log">
                            <div style="color: #666; text-align: center; padding: 2em;">No export operations yet. Run an export to see logs here.</div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>